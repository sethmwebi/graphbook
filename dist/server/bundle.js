/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={651:t=>{t.exports={development:{username:"jessica",password:"Jessica@2004",database:"graphbook_dev",host:"localhost",dialect:"mysql",pool:{max:5,min:0,acquire:3e4,idle:1e4}},production:{host:process.env.host,username:process.env.username,password:process.env.password,database:process.env.database,logging:!1,dialect:"mysql",pool:{max:5,min:0,acquire:3e4,idle:1e4}}}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=require("@babel/runtime/helpers/typeof");var e=r.n(t);const n=require("@babel/runtime/helpers/asyncToGenerator");var o=r.n(n);const a=require("express");var i=r.n(a);const c=require("path");var s=r.n(c);const u=require("helmet");var l=r.n(u);const f=require("cors");var d=r.n(f);const p=require("compression");var h=r.n(p);const m=require("graphql-upload"),v=require("apollo-server-express"),g=require("@graphql-tools/schema"),y=require("jsonwebtoken");var w=r.n(y);const E=require("@babel/runtime/helpers/defineProperty");var b=r.n(E);const x=require("winston");var O=r.n(x),S=[new(O().transports.File)({filename:"error.log",level:"error"}),new(O().transports.File)({filename:"combined.log",level:"verbose"})];const L=O().createLogger({level:"info",format:O().format.json(),transports:S}),j=require("sequelize");var k=r.n(j);const P=require("bcrypt");var _=r.n(P);const q=require("aws-sdk");var I=r.n(q);const N=require("graphql-subscriptions");function A(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?A(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function C(){C=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=b(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,i),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};s(m,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(L([])));g&&g!==r&&n.call(g,a)&&(m=g);var y=h.prototype=d.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,r){function o(a,i,c,s){var u=l(t[a],t,i);if("throw"!==u.type){var f=u.arg,d=f.value;return d&&"object"==e()(d)&&n.call(d,"__await")?r.resolve(d.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):r.resolve(d).then((function(t){f.value=t,c(f)}),(function(t){return o("throw",t,c,s)}))}s(u.arg)}var a;this._invoke=function(t,e){function n(){return new r((function(r,n){o(t,e,r,n)}))}return a=a?a.then(n,n):n()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=h,s(y,"constructor",h),s(h,"constructor",p),p.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,c,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(E.prototype),s(E.prototype,i,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new E(u(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(y),s(y,c,"Generator"),s(y,a,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}var F=new N.PubSub,M=new(I().S3)({signatureVersion:"v4",region:"us-east-2"}),T=k().Op;function R(){var t=this.db.models,e=t.Post,r=t.User,n=t.Chat,a=t.Message,i={Upload:m.GraphQLUpload,Post:{user:function(t,e,r){return t.getUser()}},Message:{user:function(t,e,r){return t.getUser()},chat:function(t,e,r){return t.getChat()}},Chat:{messages:function(t,e,r){return t.getMessages({order:[["id","ASC"]]})},users:function(t,e,r){return t.getUsers()},lastMessage:function(t,e,r){return t.getMessages({limit:1,order:[["id","DESC"]]}).then((function(t){return t[0]}))}},RootQuery:{chat:function(t,e,o){var i=e.chatId;return n.findByPk(i,{include:[{model:r,required:!0},{model:a}]})},postsFeed:function(t,n,o){var a=n.page,i=n.limit,c=n.username,s=0;a&&i&&(s=a*i);var u={order:[["createdAt","DESC"]],offset:s};return i&&(u.limit=i),c&&(u.include=[{model:r}],u.where={"$User.username$":c}),{posts:e.findAll(u)}},usersSearch:function(t,e,n){var o=e.page,a=e.limit,i=e.text;if(i.length<3)return{users:[]};var c=0;o&&a&&(c=o*a);var s={order:[["createdAt","DESC"]],offset:c};return a&&(s.limit=a),s.where={username:b()({},T.like,"%"+i+"%")},{users:r.findAll(s)}},posts:function(t,r,n){return e.findAll({order:[["createdAt","DESC"]]})},chats:function(t,e,o){return n.findAll({include:[{model:r,required:!0,through:{where:{userId:o.user.id}}},{model:a}]})},user:function(t,e,n){var o=e.username;return r.findOne({where:{username:o}})},currentUser:function(t,e,r){return r.user}},RootMutation:{logout:function(t,e,r){return r.cookies.set("authorization","",{signed:!0,expires:new Date,httpOnly:!0,secure:!1,sameSite:"strict"}),{message:!0}},signup:function(t,e,n){var a=e.email,i=e.password,c=e.username;return r.findAll({where:b()({},T.or,[{email:a},{username:c}]),raw:!0}).then(function(){var t=o()(C().mark((function t(e){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.length){t.next=4;break}throw new Error("User already exists");case 4:return t.abrupt("return",_().hash(i,10).then((function(t){return r.create({email:a,password:t,username:c,activated:1}).then((function(t){var e=w().sign({email:a,id:t.id},process.env.JWT_SECRET,{expiresIn:"1d"}),r=new Date;return r.setDate(r.getDate()+1),n.cookies.set("authorization",e,{signed:!0,expires:r,httpOnly:!0,secure:!1,sameSite:"strict"}),{token:e}}))})));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},login:function(t,e,n){var a=e.email,i=e.password;return r.findAll({where:{email:a},raw:!0}).then(function(){var t=o()(C().mark((function t(e){var r,o,c;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.length=1)){t.next=15;break}return r=e[0],t.next=4,_().compare(i,r.password);case 4:if(t.sent){t.next=7;break}throw new Error("Password does not match!");case 7:return o=w().sign({email:a,id:r.id},process.env.JWT_SECRET,{expiresIn:"1d"}),(c=new Date).setDate(c.getDate()+1),n.cookies.set("authorization",o,{signed:!0,expires:c,httpOnly:!0,secure:!1,sameSite:"strict"}),t.abrupt("return",{token:o});case 15:throw new Error("User not found");case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},addChat:function(t,e,r){var o=e.chat;return n.create().then((function(t){return Promise.all([t.setUsers(o.users)]).then((function(){return L.log({level:"info",message:"Message was created"}),t}))}))},addMessage:function(t,e,r){var n=e.message;return L.log({level:"info",message:"Message was created"}),a.create(D({},n)).then((function(t){return Promise.all([t.setUser(r.user.id),t.setChat(n.chatId)]).then((function(){return F.publish("messageAdded",{messageAdded:t}),t}))}))},addPost:function(t,n,o){var a=n.post;return r.findAll().then((function(t){var r=t[0];return e.create(D({},a)).then((function(t){return Promise.all([t.setUser(r.id)]).then((function(){L.log({level:"info",message:"Post was created"})}))}))}))},uploadAvatar:function(t,e,n){return o()(C().mark((function t(){var o,a,i,c,s,u;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.file,t.next=3,o;case 3:return a=t.sent,i=a.createReadStream,c=a.filename,a.mimetype,a.encoding,s={Bucket:"seth-apollo-book",Key:n.user.id+"/"+c,ACL:"public-read",Body:i()},t.next=12,M.upload(s).promise();case 12:return u=t.sent,t.abrupt("return",r.update({avatar:u.Location},{where:{id:n.user.id}}).then((function(){return{filename:c,url:u.Location}})));case 14:case"end":return t.stop()}}),t)})))()},deletePost:function(t,r,n){var o=r.postId;return e.destroy({where:{id:o}}).then((function(t){return 1===t?(L.log({level:"info",message:"Post "+o+" was deleted"}),{success:!0}):{success:!1}}),(function(t){L.log({level:"error",message:t.message})}))}},RootSubscription:{messageAdded:{subscribe:(0,N.withFilter)((function(){return F.asyncIterator("messageAdded")}),(function(t,e,o){return t.messageAdded.UserId!==o.user.id&&n.findOne({where:{id:t.messageAdded.ChatId},include:[{model:r,required:!0,through:{where:{userId:o.user.id}}}]}).then((function(t){return null!==t}))}))}}};return i}const U=["\t\n\tdirective @auth on QUERY | FIELD_DEFINITION | FIELD\n\tscalar Upload\n\n\ttype File {\n\t\tfilename: String!\n\t\tmimeType: String!\n\t\tencoding: String!\n\t\turl: String!\n\t}\n\n\ttype User {\n\t\tid: Int\n\t\tavatar: String\n\t\tusername: String\n\t}\n\n\ttype Post {\n\t\tid: Int\n\t\ttext: String\n\t\tuser: User\n\t}\n\n\ttype Message {\n\t\tid: Int\n\t\ttext: String\n\t\tchat: Chat\n\t\tuser: User\n\t}\n\n\ttype Chat {\n\t\tid: Int\n\t\tmessages: [Message]\n\t\tusers: [User]\n\t\tlastMessage: Message\n\t}\n\n\ttype PostFeed {\n\t\tposts: [Post]\n\t}\n\n\ttype Response {\n\t\tsuccess: Boolean\n\t}\n\n\ttype UsersSearch {\n\t\tusers: [User]\n\t}\n\n\ttype Auth {\n\t\ttoken: String\n\t}\n\n\tinput PostInput {\n\t\ttext: String!\n\t}\n\n\tinput UserInput {\n\t\tusername: String!\n\t\tavatar: String!\n\t}\n\n\tinput ChatInput {\n\t\tusers: [Int]\n\t}\n\n\tinput MessageInput {\n\t\ttext: String!\n\t\tchatId: Int!\n\t}\n\n\ttype RootMutation {\n\t\taddPost(\n\t\t\tpost: PostInput!\n\t\t): Post\n\t\taddChat(\n\t\t\tchat: ChatInput!\n\t\t): Chat\n\t\taddMessage(\n\t\t\tmessage: MessageInput!\n\t\t): Message\n\t\tdeletePost(\n\t\t\tpostId: Int!\n\t\t): Response\n\t\tlogin(\n\t\t\temail: String!\n\t\t\tpassword: String!\n\t\t): Auth\n\t\tsignup(\n\t\t\tusername: String!\n\t\t\temail: String!\n\t\t\tpassword: String!\n\t\t): Auth\n\t\tuploadAvatar(\n\t\t\tfile: Upload!\n\t\t): File @auth\n\t\tlogout: Response @auth\n\t}\n\n\ttype RootQuery {\n\t\tcurrentUser: User @auth\n\t\tposts: [Post]\n\t\tchats: [Chat] @auth\n\t\tchat(chatId: Int): Chat\n\t\tuser(username: String!): User @auth\n\t\tpostsFeed(page: Int, limit: Int, username: String): PostFeed @auth\n\t\tusersSearch(page: Int, limit: Int, text: String!): UsersSearch\n\t}\n\n\ttype RootSubscription {\n\t\tmessageAdded: Message\n\t}\n\n\tschema {\n\t\tquery: RootQuery\n\t\tmutation: RootMutation\n\t\tsubscription: RootSubscription\n\t}\n"],G=require("@graphql-tools/utils"),$=function(t){var e={};return{authDirectiveTypeDefs:"directive @".concat(t," on QUERY | FIELD_DEFINITION | FIELD"),authDirectiveTransformer:function(r){var n;return(0,G.mapSchema)(r,(n={},b()(n,G.MapperKind.TYPE,(function(n){var o,a=null===(o=(0,G.getDirective)(r,n,t))||void 0===o?void 0:o[0];a&&(e[n.name]=a)})),b()(n,G.MapperKind.OBJECT_FIELD,(function(n,o,a){var i,c;if(null!==(i=null===(c=(0,G.getDirective)(r,n,t))||void 0===c?void 0:c[0])&&void 0!==i?i:e[a]){var s=n.resolve,u=void 0===s?defaultFieldResolver:s;return n.resolve=function(t,e,r,n){if(r.user)return u(t,e,r,n);throw new Error("You need to be logged in.")},n}})),n))}}};function Q(){Q=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=b(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,i),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};s(m,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(L([])));g&&g!==r&&n.call(g,a)&&(m=g);var y=h.prototype=d.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,r){function o(a,i,c,s){var u=l(t[a],t,i);if("throw"!==u.type){var f=u.arg,d=f.value;return d&&"object"==e()(d)&&n.call(d,"__await")?r.resolve(d.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):r.resolve(d).then((function(t){f.value=t,c(f)}),(function(t){return o("throw",t,c,s)}))}s(u.arg)}var a;this._invoke=function(t,e){function n(){return new r((function(r,n){o(t,e,r,n)}))}return a=a?a.then(n,n):n()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=h,s(y,"constructor",h),s(h,"constructor",p),p.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,c,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(E.prototype),s(E.prototype,i,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new E(u(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(y),s(y,c,"Generator"),s(y,a,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}const W=function(t){var r=$("auth"),n=r.authDirectiveTypeDefs,a=r.authDirectiveTransformer,i=(0,g.makeExecutableSchema)({typeDefs:[n,U],resolvers:R.call(t)});i=a(i);var c,s=new v.ApolloServer({schema:i,context:(c=o()(Q().mark((function r(n){var o,a,i,c;return Q().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.req,a=o.headers.authorization,"undefined"===e()(a)){r.next=9;break}return i=new RegExp("Bearer","ig"),c=a.replace(i,"").trim(),r.abrupt("return",w().verify(c,process.env.JWT_SECRET,(function(e,r){return e?o:t.db.models.User.findByPk(r.id).then((function(t){return Object.assign({},o,{user:t})}))})));case 9:return r.abrupt("return",o);case 10:case"end":return r.stop()}}),r)}))),function(t){return c.apply(this,arguments)}),cache:"bounded"});return s},z=require("subscriptions-transport-ws"),Y=require("graphql");function B(){B=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=b(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,i),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};s(m,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(L([])));g&&g!==r&&n.call(g,a)&&(m=g);var y=h.prototype=d.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,r){function o(a,i,c,s){var u=l(t[a],t,i);if("throw"!==u.type){var f=u.arg,d=f.value;return d&&"object"==e()(d)&&n.call(d,"__await")?r.resolve(d.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):r.resolve(d).then((function(t){f.value=t,c(f)}),(function(t){return o("throw",t,c,s)}))}s(u.arg)}var a;this._invoke=function(t,e){function n(){return new r((function(r,n){o(t,e,r,n)}))}return a=a?a.then(n,n):n()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=h,s(y,"constructor",h),s(h,"constructor",p),p.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,c,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(E.prototype),s(E.prototype,i,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new E(u(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(y),s(y,c,"Generator"),s(y,a,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}const H=function(t){return function(r){var n,a=(0,g.makeExecutableSchema)({typeDefs:U,resolvers:R.call(t),schemaDirectives:{auth:$}});new z.SubscriptionServer({execute:Y.execute,subscribe:Y.subscribe,schema:a,onConnect:(n=o()(B().mark((function r(n,o){var a,i,c;return B().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=n.authToken,"undefined"===e()(a)){r.next=8;break}return i=new RegExp("Bearer","ig"),c=a.replace(i,"").trim(),r.abrupt("return",w().verify(c,process.env.JWT_SECRET,(function(e,r){if(e)throw new Error("Missing auth token!");return t.db.models.User.findByPk(r.id).then((function(t){return Object.assign({},o.upgradeReq,{user:t})}))})));case 8:throw new Error("Missing auth token!");case 9:case"end":return r.stop()}}),r)}))),function(t,e){return n.apply(this,arguments)})},{server:r,path:"/subscriptions"})}};var J=r(651),K=r.n(J)().production,X=new(k())(K.database,K.username,K.password,K);const V={models:function(t){var e={},r=__requireContext(__dirname,".",!0,/^\.\/(?!index\.js).*\.js$/,"sync");return r.keys().map(r).forEach((function(r){var n=r(t,k());e[n.name]=n})),Object.keys(e).forEach((function(t){e[t].associate&&e[t].associate(e)})),e}(X),sequelize:X},Z=require("@apollo/client"),tt=require("@apollo/client/link/error"),et=require("node-fetch");var rt=r.n(et);function nt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ot(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}const at=function(t,e){return new Z.ApolloClient({ssrMode:!0,link:(0,Z.from)([(0,tt.onError)((function(t){var e=t.graphQLErrors,r=t.networkError;e&&e.map((function(t){var e=t.message,r=t.locations,n=t.path;t.extensions,console.log("[GraphQL Error]: Message: ".concat(e,", Location: ").concat(r,", Path: ").concat(n))})),r&&console.log("[Network error]: ".concat(r))})),function(r,n){return e&&r.setContext((function(e){return ot(ot({},e),{},{headers:ot(ot({},e.headers),{},{Authorization:t.cookies.get("authorization")})})})),n(r)},new Z.HttpLink({uri:"http://localhost:8000/graphql",redentials:"same-origin",fetch:rt()})]),cache:new Z.InMemoryCache})},it=require("react");var ct=r.n(it);const st=require("react-dom/server");var ut=r.n(st);const lt=require("@babel/runtime/helpers/slicedToArray");var ft=r.n(lt);const dt=require("react-helmet"),pt=require("@apollo/client/react/hoc"),ht=require("@babel/runtime/helpers/objectWithoutProperties");var mt=r.n(ht);const vt=require("@babel/runtime/helpers/extends");var gt=r.n(vt);const yt=require("react-router-dom"),wt=require("@babel/runtime/helpers/taggedTemplateLiteral");var Et,bt,xt=r.n(wt),Ot=(0,Z.gql)(Et||(Et=xt()(["\n  mutation login($email: String!, $password: String!){\n  \tlogin(email: $email, password: $password){\n  \t\ttoken\n  \t}\n  }\n"]))),St=(0,Z.gql)(bt||(bt=xt()(["\n  mutation signup($email: String!, $password: String!, $username: String!){\n  \tsignup(email: $email, password: $password, username: $username){\n  \t\ttoken\n  \t}\n  }\n"])));const Lt=function(t){var r=t.color,n=t.size,o={backgroundColor:"#6ca6fd",width:40,height:40};return"undefined"!==e()(r)&&(o.color=r),"undefined"!==e()(n)&&(o.width=n,o.height=n),ct().createElement("div",{className:"bouncer",style:o})},jt=function(t){var e=t.children;return ct().createElement("div",{className:"error message"},e)};var kt=function(t){var e=t.changeLoginState,r=(0,it.useState)(""),n=ft()(r,2),o=n[0],a=n[1],i=(0,it.useState)(""),c=ft()(i,2),s=c[0],u=c[1],l=(0,Z.useMutation)(Ot),f=ft()(l,2),d=f[0],p=f[1],h=p.loading,m=p.error;return ct().createElement("div",{className:"login"},!h&&ct().createElement("form",{onSubmit:function(t){t.preventDefault(),d({update:function(t,r){var n=r.data.login;n.token&&(localStorage.setItem("jwt",n.token),e(!0))},variables:{email:o,password:s}})}},ct().createElement("label",null,"Email"),ct().createElement("input",{type:"text",onChange:function(t){return a(t.target.value)}}),ct().createElement("label",null,"Password"),ct().createElement("input",{type:"password",onChange:function(t){return u(t.target.value)}}),ct().createElement("input",{type:"submit",value:"Login"})),h&&ct().createElement(Lt,null),m&&ct().createElement(jt,null,"There was an error logging in!"))},Pt=function(t){var e=t.changeLoginState,r=(0,it.useState)(""),n=ft()(r,2),o=n[0],a=n[1],i=(0,it.useState)(""),c=ft()(i,2),s=c[0],u=c[1],l=(0,it.useState)(""),f=ft()(l,2),d=f[0],p=f[1],h=(0,Z.useMutation)(St),m=ft()(h,2),v=m[0],g=m[1],y=g.loading,w=g.error;return ct().createElement("div",{className:"login"},!y&&ct().createElement("form",{onSubmit:function(t){t.preventDefault(),v({update:function(t,r){var n=r.data.login;n.token&&(localStorage.setItem("jwt",n.token),e(!0))},variables:{email:o,password:s,username:d}})}},ct().createElement("label",null,"Email"),ct().createElement("input",{type:"text",onChange:function(t){return a(t.target.value)}}),ct().createElement("label",null,"Username"),ct().createElement("input",{type:"text",onChange:function(t){return p(t.target.value)}}),ct().createElement("label",null,"Password"),ct().createElement("input",{type:"password",onChange:function(t){return u(t.target.value)}}),ct().createElement("input",{type:"submit",value:"Sign up"})),y&&ct().createElement(Lt,null),w&&ct().createElement(jt,null,ct().createElement("p",null,"There was an error logging in!")))};const _t=function(t){var e=t.changeLoginState,r=(0,it.useState)(!0),n=ft()(r,2),o=n[0],a=n[1];return ct().createElement("div",{className:"authModal"},o&&ct().createElement("div",null,ct().createElement(kt,{changeLoginState:e}),ct().createElement("a",{onClick:function(){return a(!1)}},"Want to sign up? Click here")),!o&&ct().createElement("div",null,ct().createElement(Pt,{changeLoginState:e}),ct().createElement("a",{onClick:function(){return a(!0)}},"Want to login? Click here")))},qt=require("@babel/runtime/helpers/toConsumableArray");var It=r.n(qt);const Nt=require("react-infinite-scroll-component");var At=r.n(Nt);const Dt=require("prop-types");var Ct=r.n(Dt);const Ft=function(t){var e,r=t.trigger,n=t.children,o=(0,it.useState)(!1),a=ft()(o,2),i=a[0],c=a[1],s=(0,it.useRef)(null);return e=s,(0,it.useEffect)((function(){function t(){e.current&&!e.current.contains(event.target)&&c(!1)}return document.addEventListener("mousedown",t),function(){document.removeEventListener("mousedown",t)}}),[e]),ct().createElement("div",{className:"dropdown"},ct().createElement("div",null,ct().createElement("div",{className:"trigger",onClick:function(){return c((function(t){return!t}))}},r),ct().createElement("div",{ref:s},i&&ct().createElement("div",{className:"content"},n))))},Mt=require("@fortawesome/react-fontawesome");var Tt;function Rt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ut(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Rt(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Rt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Gt=(0,Z.gql)(Tt||(Tt=xt()(["\n\tmutation deletePost($postId: Int!) {\n\t\tdeletePost(postId: $postId) {\n\t\t\tsuccess\n\t\t}\n\t}\n"])));const $t=function(t){var e=t.post,r=(e.id,(0,Z.useMutation)(Gt,{update:function(t,e){e.data.deletePost.success&&t.modify({fields:{postsFeed:function(t,e){var r=e.readField;return Ut(Ut({},t),{},{posts:t.posts.filter((function(t){return postId!==r("id",t)}))})}}})}})),n=ft()(r,1)[0];return ct().createElement("div",{className:"header"},ct().createElement(yt.Link,{to:"/user/"+e.user.username},ct().createElement("img",{src:e.user.avatar}),ct().createElement("div",null,ct().createElement("h2",null,e.user.username))),ct().createElement(Ft,{trigger:ct().createElement(Mt.FontAwesomeIcon,{icon:"angle-down"})},ct().createElement("button",{onClick:function(){return n({variables:{postId:e.id}})}},"Delete")))},Qt=function(t){var e=t.post;return ct().createElement("p",{className:"content"},e.text)};var Wt=function(t){var e=t.post;return ct().createElement("div",{className:"post "+(e.id<0?"optimistic":"")},ct().createElement($t,{post:e}),ct().createElement(Qt,{post:e}))};Wt.propTypes={post:Ct().shape({id:Ct().number.isRequired,text:Ct().string.isRequired,user:Ct().shape({avatar:Ct().string.isRequired,username:Ct().string.isRequired}).isRequired}).isRequired};const zt=Wt,Yt=function(t){var e=t.fetchMore,r=t.posts,n=(0,it.useState)(!0),o=ft()(n,2),a=o[0],i=o[1],c=(0,it.useState)(0),s=ft()(c,2),u=s[0],l=s[1];return ct().createElement("div",{className:"feed"},ct().createElement(At(),{dataLength:r.length,next:function(){return function(t){t({variables:{page:u+1},updateQuery:function(t,e){var r=e.fetchMoreResult;return r.postsFeed.posts.length?(l(u+1),{postsFeed:{__typename:"PostFeed",posts:[].concat(It()(t.postsFeed.posts),It()(r.postsFeed.posts))}}):(i(!1),t)}})}(e)},hasMore:a,loader:ct().createElement("div",{className:"loader",key:"loader"},"Loading...")},r.map((function(t,e){return ct().createElement(zt,{key:t.id,post:t})}))))};var Bt,Ht,Jt=(0,Z.gql)(Bt||(Bt=xt()(["\n\tfragment userAttributes on User {\n\t\tid\n\t\tusername\n\t\tavatar\n\t}\n"])));function Kt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Xt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Kt(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Kt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Vt,Zt,te=(0,Z.gql)(Ht||(Ht=xt()(["\n  query postsFeed($page: Int, $limit: Int, $username: String){\n  \tpostsFeed(page: $page, limit: $limit, username: $username){\n  \t\tposts {\n  \t\t\tid\n  \t\t\ttext\n  \t\t\tuser {\n  \t\t\t\t...userAttributes\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n  ","\n"])),Jt),ee=function(t){return(0,Z.useQuery)(te,{pollInterval:5e3,variables:Xt({page:0,limit:10},t)})};function re(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ne(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?re(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var oe=(0,Z.gql)(Vt||(Vt=xt()(["\n\tmutation addPost($post: PostInput!) {\n\t\taddPost(post: $post) {\n\t\t\tid\n\t\t\ttext\n\t\t\tuser {\n\t\t\t\t...userAttributes\n\t\t\t}\n\t\t}\n\t}\n\t","\n"])),Jt);const ae=function(){var t=(0,it.useState)(""),e=ft()(t,2),r=e[0],n=e[1],o=(0,it.useState)(0),a=ft()(o,2),i=a[0],c=a[1],s=ee(),u=s.loading,l=s.error,f=s.data,d=s.fetchMore,p=function(t){return(0,Z.useMutation)(oe,function(t){return{optimisticResponse:{__typename:"mutation",addPost:{__typename:"Post",text:t,id:-1,user:{__typename:"User",username:"Loading...",avatar:"/public/loading.gif"}}},update:function(t,e){var r=e.data.addPost;t.modify({fields:{postsFeed:function(e){var n=e.posts,o=t.writeFragment({data:r,fragment:(0,Z.gql)(Zt||(Zt=xt()(["\n\t\t\t\t\t\t\tfragment NewPost on Post {\n\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\ttype\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t"])))});return ne(ne({},e),{},{posts:[o].concat(It()(n))})}}})}}}(t))}(r),h=ft()(p,1)[0];if(u)return ct().createElement(Lt,null);if(l)return ct().createElement(jt,null,ct().createElement("p",null,l.message));var m=f.postsFeed.posts;return ct().createElement("div",{className:"container"},ct().createElement("div",{className:"postForm"},ct().createElement("form",{onSubmit:function(t){t.preventDefault(),h({variables:{post:{text:r}}}),n("")}},ct().createElement("textarea",{value:r,onChange:function(t){return n(t.target.value)},placeholder:"Write your custom post!"}),ct().createElement("input",{type:"submit",value:"Submit"}))),ct().createElement(Yt,{posts:m,fetchMore:function(){d({variables:{page:i+1},updateQuery:function(t,e){var r=e.fetchMoreResult;return r.postsFeed.posts.length?(c(i+1),{postsFeed:{__typename:"PostFeed",posts:[].concat(It()(t.postsFeed.posts),It()(r.postsFeed.posts))}}):(setHasMore(!1),t)}})}}))};var ie,ce,se,ue=(0,Z.gql)(ie||(ie=xt()(["\n\tquery chat($chatId: Int!) {\n\t\tchat(chatId: $chatId) {\n\t\t\tid\n\t\t\tusers {\n\t\t\t\tid\n\t\t\t\t...userAttributes\n\t\t\t}\n\t\t\tmessages {\n\t\t\t\tid\n\t\t\t\ttext\n\t\t\t\tuser {\n\t\t\t\t\tid\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t","\n"])),Jt),le=(0,Z.gql)(ce||(ce=xt()(["\n\tmutation AddMessage($message: MessageInput!) {\n\t\taddMessage(message: $message) {\n\t\t\tid\n\t\t\ttext\n\t\t\tuser {\n\t\t\t\tid\n\t\t\t}\n\t\t}\n\t}\n"]))),fe=(0,Z.gql)(se||(se=xt()(["\n\tfragment NewMessage on Chat {\n\t\tid\n\t\ttype\n\t}\n"])));const de=function(t){var e=t.chatId,r=t.closeChat,n=function(t){return(0,Z.useQuery)(ue,{variables:{chatId:t}})}(e),o=n.loading,a=n.error,i=n.data,c=(0,it.useState)(""),s=ft()(c,2),u=s[0],l=s[1],f=function(t){return(0,Z.useMutation)(le,function(t){return{update:function(e,r){var n=r.data.addMessage;e.modify({id:e.identify(t.chat),fields:{messages:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=e.writeFragment({data:n,fragment:fe});return[].concat(It()(t),[r])}}})}}}(t))}(i),d=ft()(f,1)[0];if(o)return ct().createElement("div",{className:"chatWindow"},ct().createElement(Lt,null));if(a)return ct().createElement("div",{className:"chatWindow"},ct().createElement(jt,null,ct().createElement("p",null,a.message)));var p=i.chat;return ct().createElement("div",{className:"chatWindow"},ct().createElement("div",{className:"header"},ct().createElement("span",null,p.users[1].username),ct().createElement("button",{className:"close",onClick:function(){return r(e)}},"X")),ct().createElement("div",{className:"messages"},p.messages.map((function(t,e){return ct().createElement("div",{key:"message"+t.id,className:"message "+(t.user.id>15?"left":"right")},t.text)}))),ct().createElement("div",{className:"input"},ct().createElement("input",{type:"text",onChange:function(t){return l(t.target.value)},onKeyPress:function(t){return function(t){"Enter"===t.key&&u.length&&d({variables:{message:{text:u,chatId:e}}}).then((function(){l("")}))}(t)}})))};var pe,he,me=(0,Z.gql)(pe||(pe=xt()(["\n  query chats {\n  \tchats {\n  \t\tid\n  \t\tusers {\n  \t\t\tid\n  \t\t\t...userAttributes\n  \t\t}\n  \t\tlastMessage {\n  \t\t\ttext\n  \t\t}\n  \t}\n  }\n  ","\n"])),Jt),ve=(0,Z.gql)(he||(he=xt()(["\n  subscription onMessageAdded{\n  \tmessageAdded {\n  \t\tid\n  \t\ttext\n  \t\tchat {\n  \t\t\tid\n  \t\t}\n  \t\tuser {\n  \t\t\tid\n  \t\t\t__typename\n  \t\t}\n  \t\t__typename\n  \t}\n  }\n"])));const ge=require("react-toastify");var ye,we,Ee=(0,Z.gql)(ye||(ye=xt()(["\n  subscription onMessageAdded {\n    messageAdded {\n      id\n      text\n      chat {\n        id\n      }\n      user {\n        id\n        __typename\n      }\n      __typename\n    }\n  }\n"]))),be=(0,Z.gql)(we||(we=xt()(["\n  query currentUser {\n  \tcurrentUser {\n  \t\tid\n  \t\tusername\n  \t\tavatar\n  \t}\n  }\n"]))),xe=function(t){var e=t.children;return ct().createElement(Z.ApolloConsumer,null,(function(t){var r=t.readQuery({query:be});return ct().Children.map(e,(function(t){return ct().cloneElement(t,{user:null!=r&&r.currentUser?r.currentUser:null})}))}))},Oe=function(t,e){return e.length>2?"/public/group.png":e[0].id!==t.id?e[0].avatar:e[1].avatar};const Se=function(t){var e,r,n=t.user,o=t.chat,a=t.openChat;return ct().createElement("div",{key:o.id,className:"chat",onClick:function(){return a(o.id)}},ct().createElement("div",{className:"header"},ct().createElement("img",{src:Oe(n,o.users)}),ct().createElement("div",null,ct().createElement("h2",null,(r=function(t,e){for(var r="",n=0;n<e.length;n++)e[n].username!==t.username&&(r+=e[n].username),n-1===e.length&&(r+=", ");return r}(n,o.users),r.length?r.length>12?r.substring(0,r.length-9)+"...":r:"")),ct().createElement("span",null,null==o||null===(e=o.lastMessage)||void 0===e?void 0:e.text))))};var Le=function(t){var e,r=t.client,n=t.user,o=(0,Z.useQuery)(me),a=o.loading,i=o.error,c=o.data,s=o.subscribeToMore,u=(0,it.useState)([]),l=ft()(u,2),f=l[0],d=l[1];e={onSubscriptionData:function(t){t&&t.subscriptionData&&t.subscriptionData.data&&t.subscriptionData.data.messageAdded&&(0,ge.toast)(t.subscriptionData.data.messageAdded.text,{position:ge.toast.POSITION.TOP_LEFT})}},(0,Z.useSubscription)(Ee,e);var p=function(t){var e=f.slice();-1===e.indexOf(t)&&(e.length>2&&(e=e.slice(1)),e.push(t)),d(e)};(0,it.useEffect)((function(){s({document:ve,updateQuery:function(t,e){var o=e.subscriptionData;if(!o.data||!t.chats.length)return t;for(var a=-1,i=0;i<t.chats.length;i++)if(t.chats[i].id==o.data.messageAdded.chat.id){a=i;break}if(-1===a)return t;var c=Object.assign({},t.chats[i],{lastMessage:{text:o.data.messageAdded.text,__typename:o.data.messageAdded.__typename}});if(n.id!==o.data.messageAdded.user.id)try{var s=r.readQuery({query:ue,variables:{chatId:o.data.messageAdded.chat.id}});r.cache.modify({id:r.cache.identify(s.chat),fields:{messages:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=r.cache.writeFragment({data:o.data.messageAdded,fragment:fe});return[].concat(It()(t),[e])}}})}catch(t){}var u={chats:It()(t.chats)};return u.chats[i]=c,u}})}),[]);var h=function(t){var e=f.slice(),r=e.indexOf(t);e.splice(r,1),d(e)};if(a)return ct().createElement(Lt,null);if(i)return ct().createElement("div",{className:"chats"},ct().createElement(Lt,null,ct().createElement("p",null,i.message)));var m=c.chats;return ct().createElement("div",{className:"wrapper"},ct().createElement(ge.ToastContainer,null),ct().createElement("div",{className:"chats"},m.map((function(t,e){return ct().createElement(Se,{key:"chatItem"+t.id,chat:t,user:n,openChat:p})}))),ct().createElement("div",{className:"openChats"},f.map((function(t,e){return ct().createElement(de,{chatId:t,key:"chatWindow"+t,closeChat:h})}))))};const je=(0,pt.withApollo)((function(t){return ct().createElement(xe,null,ct().createElement(Le,t))}));var ke,Pe=(0,Z.gql)(ke||(ke=xt()(["\n  query usersSearch($page: Int, $limit: Int, $text: String!){\n  \tusersSearch(page: $page, limit: $limit, text: $text){\n  \t\tusers {\n  \t\t\tid\n  \t\t\t...userAttributes\n  \t\t}\n  \t}\n  }\n  ","\n"])),Jt);const _e=function(t){var e=t.data.usersSearch.users,r=(0,it.useState)(!1),n=ft()(r,2),o=n[0],a=n[1],i=function t(e){e?document.addEventListener("click",t.bind(null,!e),!0):document.removeEventListener("click",t.bind(null,!e),!0),a(e)};return(0,it.useEffect)((function(){!function(t){t.length?i(!0):i(!1)}(e)}),[e]),(0,it.useEffect)((function(){return function(){return document.removeEventListener("click",i.bind(null,!o),!0)}})),o&&ct().createElement("div",{className:"result"},e.map((function(t,e){return ct().createElement("div",{className:"user",key:t.id},ct().createElement("img",{src:t.avatar}),ct().createElement("span",null,t.username))})))},qe=function(){var t=(0,it.useState)(""),e=ft()(t,2),r=e[0],n=e[1],o=function(t){return(0,Z.useQuery)(Pe,function(t){return{variables:{page:0,limit:5,text:t},skip:t.length<3}}(t))}(r),a=o.loading,i=o.error,c=o.data;return ct().createElement("div",{className:"search"},ct().createElement("input",{type:"text",onChange:function(t){n(t.target.value)},value:r}),!a&&!i&&c&&ct().createElement(_e,{data:c}))},Ie=require("react-modal");var Ne=r.n(Ie);const Ae=require("react-cropper");var De=r.n(Ae);const Ce=require("react-dropzone");var Fe,Me=(0,Z.gql)(Fe||(Fe=xt()(["\n  mutation uploadAvatar($file: Upload!) {\n    uploadAvatar(file : $file) {\n      filename\n      url\n    }\n  }\n"])));Ne().setAppElement("#root");var Te={content:{width:"400px",height:"450px",top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}};const Re=function(t){var e=t.isOpen,r=t.showModal,n=(0,it.useState)(null),o=ft()(n,2),a=o[0],i=o[1],c=(0,it.useState)(null),s=ft()(c,2),u=s[0],l=s[1],f=(0,Z.useMutation)(Me,{update:function(t,e){var r=e.data.uploadAvatar;console.log(r),r&&r.url&&t.modify({fields:{currentUser:function(e,n){n.readField,t.modify({id:e,fields:{avatar:function(){return r.url}}})}}})}}),d=ft()(f,2),p=d[0],h=d[1],m=(h.loading,h.error),v=(0,it.useRef)(null),g=(0,Ce.useDropzone)({onDrop:function(t){var e=new FileReader;e.onload=function(){i({src:e.result,filename:t[0].name,filetype:t[0].type,result:e.result,error:null})},e.readAsDataURL(t[0])}}),y=g.getRootProps,w=g.getInputProps,E=g.isDragActive;return m?ct().createElement(jt,null,ct().createElement("p",null,m.message)):ct().createElement(Ne(),{isOpen:e,onRequestClose:r,contentLabel:"Change avatar",style:Te},!a&&ct().createElement("div",gt()({className:"drop"},y()),ct().createElement("input",w()),E?ct().createElement("p",null,"Drop the files here ..."):ct().createElement("p",null,"Drag 'n' drop some files here, or click to select files")),a&&ct().createElement(De(),{ref:v,src:a.src,style:{height:400,width:"100%"},initialAspectRatio:16/9,guides:!1,crop:function(){var t=null==v?void 0:v.current,e=null==t?void 0:t.cropper;l(e.getCroppedCanvas().toDataURL())}}),a&&ct().createElement("button",{className:"cancelUpload",onClick:function(){i(null)}},"Change image"),ct().createElement("button",{className:"uploadAvatar",onClick:function(){var t=function(t){for(var e=atob(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return new Blob([n],{type:r})}(u);t.name=a.filename,p({variables:{file:t}}).then((function(){r()}))}},"Save"))},Ue=function(t){var e=t.user;if(!e)return null;var r=(0,it.useState)(!1),n=ft()(r,2),o=n[0],a=n[1],i=function(){a(!o)};return ct().createElement("div",{className:"user"},ct().createElement("img",{src:e.avatar,onClick:function(){return i()}}),ct().createElement(Re,{isOpen:o,showModal:i}),ct().createElement("span",null,e.username))};var Ge,$e=(0,Z.gql)(Ge||(Ge=xt()(["\n\tmutation logout {\n\t\tlogout {\n\t\t\tsuccess\n\t\t}\n\t}\n"])));const Qe=(0,pt.withApollo)((function(t){var e=t.changeLoginState,r=t.client,n=(0,Z.useMutation)($e),o=ft()(n,1)[0];return ct().createElement("button",{className:"logout",onClick:function(){o().then((function(){localStorage.removeItem("jwt"),e(!1),r.stop(),r.resetStore()}))}},"Logout")}));(0,yt.withRouter)((function(t){var e=t.history;return ct().createElement("div",{className:"goHome",onClick:function(){e.push("/app")}},"Home")}));const We=function(t){var e=t.changeLoginState;return ct().createElement("div",{className:"topbar"},ct().createElement("div",{className:"inner"},ct().createElement(qe,null),ct().createElement(xe,null,ct().createElement(Ue,null))),ct().createElement("div",{className:"buttons"},ct().createElement(Qe,{changeLoginState:e})))},ze=function(t){var e=t.changeLoginState;return ct().createElement(ct().Fragment,null,ct().createElement(We,{changeLoginState:e}),ct().createElement(ae,null),ct().createElement(je,null))},Ye=function(t){var e=t.user,r=e.avatar,n=e.username;return ct().createElement("div",{className:"profileHeader"},ct().createElement("div",{className:"avatar"},ct().createElement("img",{src:r})),ct().createElement("div",{className:"information"},ct().createElement("p",null,n),ct().createElement("p",null,"You can provide further information here and build your really personal header component for your users.")))};var Be;function He(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Je(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?He(Object(r),!0).forEach((function(e){b()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Ke=(0,Z.gql)(Be||(Be=xt()(["\n\tquery user($username: String!){\n\t\tuser(username: $username){\n\t\t\t...userAttributes\n\t\t}\n\t}\n\t","\n"])),Jt);const Xe=function(t){var e,r=t.username,n=(e={username:r},(0,Z.useQuery)(Ke,{variables:Je({},e)})),o=n.data,a=n.loading,i=ee({username:r}),c=i.loading,s=i.error,u=i.data,l=i.fetchMore;return c||a?ct().createElement(Lt,null):s?ct().createElement(jt,null,ct().createElement("p",null,s.message)):ct().createElement("div",{className:"user"},ct().createElement("div",{className:"inner"},ct().createElement(Ye,{user:o.user})),ct().createElement("div",{className:"container"},ct().createElement(Yt,{posts:u.postsFeed.posts,fetchMore:l})))},Ve=function(t){var e=t.changeLoginState,r=t.match;return ct().createElement(ct().Fragment,null,ct().createElement(We,{changeLoginState:e}),ct().createElement(Xe,{username:r.params.username}),ct().createElement(je,null))};var Ze,tr=["component"],er=["component"];Ze="undefined"!==("undefined"==typeof window?"undefined":e()(window))?yt.BrowserRouter:yt.StaticRouter;var rr=function(t){var e=t.component,r=mt()(t,tr);return ct().createElement(yt.Route,gt()({},r,{render:function(t){return!0===r.loggedIn?ct().createElement(e,t):ct().createElement(yt.Redirect,{to:{pathname:"/",state:{from:t.location}}})}}))},nr=function(t){var r=t.component,n=mt()(t,er);return ct().createElement(yt.Route,gt()({},n,{render:function(t){return!1===n.loggedIn?ct().createElement(r,t):ct().createElement(yt.Redirect,{to:{pathname:"undefined"!==e()(t.location.state)?t.location.state.from.pathname:"/app"}})}}))},or=function(){return ct().createElement(yt.Redirect,{to:"/"})};const ar=function(t){var e=t.changeLoginState,r=t.loggedIn,n=t.context;return t.location,ct().createElement(Ze,{context:n,location:n},ct().createElement(yt.Switch,null,ct().createElement(rr,{path:"/app",component:function(){return ct().createElement(ze,{changeLoginState:e})},loggedIn:r}),ct().createElement(rr,{path:"/user/:username",component:function(t){return ct().createElement(Ve,gt()({},t,{changeLoginState:e}))},loggedIn:r}),ct().createElement(nr,{exact:!0,path:"/",component:function(){return ct().createElement(_t,{changeLoginState:e})},loggedIn:r}),ct().createElement(yt.Route,{component:or})))},ir=require("@fortawesome/fontawesome-svg-core"),cr=require("@fortawesome/free-solid-svg-icons");ir.library.add(cr.faAngleDown);const sr=(0,pt.withApollo)((function(t){var e=t.location,r=t.context,n=t.loggedIn,o=(0,Z.useQuery)(be,undefined),a=(o.data,o.loading,o.error,(0,it.useState)(n)),i=ft()(a,2),c=i[0],s=i[1];return ct().createElement("div",{className:"container"},ct().createElement(dt.Helmet,null,ct().createElement("title",null,"Graphbook - Feed"),ct().createElement("meta",{name:"description",content:"News of all your friends on Graphbook"})),ct().createElement(ar,{loggedIn:c,changeLoginState:s,location:e,context:r}))})),ur=function(t){var e=t.client,r=t.location,n=t.context,o=t.loggedIn;return ct().createElement(Z.ApolloProvider,{client:e},ct().createElement(sr,{location:r,context:n,loggedIn:o}))},lr=function(t,e,r){return'\n\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t  <meta charSet="UTF-8"/>\n\t\t\t  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>\n\t\t\t  <meta httpEquiv="X-UA-Compatible" content="ie=edge"/>\n\t\t\t  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">\n\t\t\t  '.concat("<link rel='stylesheet' href='/bundle.css'/>","\n\t\t\t  ").concat(e.title.toString(),"\n\t\t\t  ").concat(e.meta.toString(),"\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t ").concat(ut().renderToStaticMarkup(ct().createElement("div",{id:"root",dangerouslySetInnerHTML:{__html:t}})),"\n        ").concat(ut().renderToStaticMarkup(ct().createElement("script",{dangerouslySetInnerHTML:{__html:"window.__APOLLO_STATE__=".concat(JSON.stringify(r).replace(/</g,"\\u003c"))}})),'\n\t\t\t\t<script src="/bundle.js"><\/script>\n\t\t\t</body>\n\t\t</html>\n\t')},fr=require("dotenv"),dr=require("cookies");var pr=r.n(dr);const hr=require("@apollo/client/react/ssr"),mr=require("http");function vr(){vr=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=b(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,i),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function h(){}var m={};s(m,a,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(L([])));g&&g!==r&&n.call(g,a)&&(m=g);var y=h.prototype=d.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,r){function o(a,i,c,s){var u=l(t[a],t,i);if("throw"!==u.type){var f=u.arg,d=f.value;return d&&"object"==e()(d)&&n.call(d,"__await")?r.resolve(d.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):r.resolve(d).then((function(t){f.value=t,c(f)}),(function(t){return o("throw",t,c,s)}))}s(u.arg)}var a;this._invoke=function(t,e){function n(){return new r((function(r,n){o(t,e,r,n)}))}return a=a?a.then(n,n):n()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=h,s(y,"constructor",h),s(h,"constructor",p),p.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,c,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(E.prototype),s(E.prototype,i,(function(){return this})),t.AsyncIterator=E,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new E(u(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(y),s(y,c,"Generator"),s(y,a,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}fr.config();var gr,yr={graphql:W(gr={db:V}),subscriptions:H(gr)},wr=s().join(__dirname,"../../"),Er=i()(),br=(0,mr.createServer)(Er);Er.use(h()()),Er.use(l()()),Er.use(l().contentSecurityPolicy({directives:{defaultSrc:["'self'"],scriptSrc:["'self'","'unsafe-inline'"],styleSrc:["'self'","'unsafe-inline'"],imgSrc:["'self'","data:","*.amazonaws.com"]}})),Er.use(l().referrerPolicy({policy:"same-origin"})),Er.use((function(t,e,r){t.cookies=new(pr())(t,e,{keys:["Some random keys"]}),r()})),Er.use(d()()),Er.use("/",i().static(s().join(wr,"dist/client"))),Er.use("/uploads",i().static(s().join(wr,"uploads"))),Er.get("*",function(){var t=o()(vr().mark((function t(e,r){var n,o,a,i,c;return vr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.cookies.get("authorization",{signed:!0}),t.prev=1,t.next=4,w().verify(n,JWT_SECRET);case 4:o=!0,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),o=!1;case 10:a=at(e,o),i={},c=ct().createElement(ur,{client:a,loggedIn:o,location:e.url,context:i}),(0,hr.renderToStringWithData)(c).then((function(t){var e=a.extract();if(i.url)r.redirect(301,i.url);else{var n=dt.Helmet.renderStatic();r.status(200),r.send("<!doctype html>\n".concat(lr(t,n,e))),r.end()}}));case 14:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,r){return t.apply(this,arguments)}}());for(var xr=Object.keys(yr),Or=function(t){var e=xr[t];switch(e){case"graphql":o()(vr().mark((function t(){return vr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,yr[e].start();case 2:Er.use((0,m.graphqlUploadExpress)()),yr[e].applyMiddleware({app:Er});case 4:case"end":return t.stop()}}),t)})))();break;case"subscriptions":br.listen(8e3,(function(){console.log("Listening on port 8000!"),yr[e](br)}));break;default:Er.use("/".concat(e),yr[e])}},Sr=0;Sr<xr.length;Sr+=1)Or(Sr)})()})();